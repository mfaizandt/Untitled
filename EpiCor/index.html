<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parts Catalog Browser</title>
    
    <!-- External Libraries -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.12/themes/default/style.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.12/jstree.min.js"></script>
    
    <!-- Application Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                <div>
                    <h1>üöó Vehicle Parts Catalog</h1>
                    <p>Browse and search through our comprehensive parts database</p>
                </div>
                <button class="btn btn-secondary" id="logoutBtn" style="display: none; background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.3);">
                    üö™ Logout
                </button>
            </div>
        </div>
        
        <!-- Progress Summary Section -->
        <div id="progressSummary" class="progress-summary hidden">
            <div class="progress-summary-header">
                <h3>üìä Progress Summary</h3>
            </div>
            <div class="progress-sections">
                <!-- Vehicle Information Section -->
                <div id="vehicleInfoSection" class="progress-section hidden">
                    <div class="progress-section-title">üöó Vehicle Information</div>
                    <div id="vehicleInfoContent"></div>
                    <button class="download-btn" id="downloadVinBtn" onclick="downloadVinResponse()">üì• Download VIN Response</button>
                </div>
                
                <!-- Catalog Selection Section -->
                <div id="catalogSelectionSection" class="progress-section hidden">
                    <div class="progress-section-title">üìã Catalog Selection</div>
                    <div id="catalogSelectionContent"></div>
                    <button class="download-btn" id="downloadCategoryTreeBtn" onclick="downloadCategoryTree()">üì• Download Category Tree</button>
                </div>
                
                <!-- Manufacturer Selection Section -->
                <div id="manufacturerSelectionSection" class="progress-section hidden">
                    <div class="progress-section-title">üè≠ Manufacturer Selection</div>
                    <div id="manufacturerSelectionContent"></div>
                    <button class="download-btn" id="downloadManufacturersBtn" onclick="downloadManufacturers()">üì• Download Manufacturers</button>
                </div>
                
                <!-- Parts Section -->
                <div id="partsSection" class="progress-section hidden">
                    <div class="progress-section-title">üîß Parts</div>
                    <div id="partsContent"></div>
                    <button class="download-btn" id="downloadPartsBtn" onclick="downloadParts()">üì• Download Parts</button>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <div class="controls-group">
                <label>Quick Actions:</label>
                <button class="btn btn-primary" id="expandAllBtn">Expand All</button>
                <button class="btn btn-secondary" id="collapseAllBtn">Collapse All</button>
            </div>
            
            <div class="controls-group">
                <input type="text" id="search" placeholder="üîç Search categories, groups, or parts...">
                <span id="searchLoading" class="search-loading" style="display: none;">
                    <span class="spinner"></span>Searching...
                </span>
            </div>
        </div>
        
        <div class="content">
            <div id="statusMessage" class="status-message"></div>
            
            <!-- Login Form -->
            <div id="loginForm" class="auth-form">
                <h2>üîê Login Required</h2>
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Enter your username">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter your password">
                </div>
                <div class="form-actions">
                    <button class="btn btn-primary" id="loginBtn">Login</button>
                </div>
            </div>
            
            <!-- VIN Input Form -->
            <div id="vinForm" class="auth-form hidden">
                <h2>üöó Enter Vehicle VIN</h2>
                <div class="form-group">
                    <label for="vin">Vehicle VIN (17 characters)</label>
                    <input type="text" id="vin" placeholder="Enter vehicle VIN" maxlength="17">
                </div>
                <div class="form-actions">
                    <button class="btn btn-primary" id="decodeVinBtn">Decode VIN</button>
                </div>
            </div>
            
            <!-- Manufacturer Selection Form -->
            <div id="manufacturerSelection" class="auth-form hidden">
                <div class="breadcrumb" id="manufacturerBreadcrumb">
                    <span class="breadcrumb-item">
                        <a href="#" class="breadcrumb-link" id="breadcrumbVinFromManufacturers">VIN</a>
                    </span>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <span class="breadcrumb-item">
                        <a href="#" class="breadcrumb-link" id="breadcrumbTree">Catalog Tree</a>
                    </span>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <span class="breadcrumb-item active">
                        <span id="breadcrumbCatalogName">Select Manufacturers</span>
                    </span>
                </div>
                <div class="nav-header">
                    <div class="nav-title">
                        <h2>üè≠ Select Manufacturers</h2>
                        <span class="subtitle" id="manufacturerSubtitle">Select manufacturers and brands for the catalog object</span>
                    </div>
                    <button class="btn btn-secondary" id="backToTreeBtn">‚Üê Back to Catalog</button>
                </div>
                <div id="manufacturerLoading" class="upload-loader" style="display: none;">
                    <div class="loader-content">
                        <div class="upload-spinner"></div>
                        <div class="upload-info">Loading manufacturers...</div>
                    </div>
                </div>
                <div id="manufacturerContent" style="display: none;">
                    <div class="form-group">
                        <label for="manufacturerSearch">Search Manufacturers or Brands:</label>
                        <input type="text" id="manufacturerSearch" placeholder="Type to search..." />
                    </div>
                    <div class="selection-summary-bar" style="display: flex; justify-content: space-between; align-items: center; margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                        <span id="selectedCount">0 brands selected</span>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-secondary" id="selectAllBtn">Select All</button>
                            <button class="btn btn-secondary" id="deselectAllBtn">Deselect All</button>
                        </div>
                    </div>
                    <div id="manufacturerList" style="max-height: 500px; overflow-y: auto; border: 1px solid #e9ecef; border-radius: 5px; padding: 15px;"></div>
                    <div class="form-actions" style="margin-top: 20px;">
                        <button class="btn btn-primary" id="viewPartsBtn">View Parts ‚Üí</button>
                    </div>
                </div>
            </div>
            
            <!-- Part Detail Modal -->
            <div id="partDetailModal" class="modal hidden">
                <div class="modal-content" style="max-width: 90%; max-height: 90vh; overflow-y: auto;">
                    <div class="modal-header">
                        <h2>üì¶ Part Details</h2>
                        <button class="modal-close" id="closePartDetailModal">&times;</button>
                    </div>
                    <div class="modal-body" id="partDetailContent">
                        <div style="text-align: center; padding: 20px;">
                            <div class="spinner"></div>
                            <p>Loading part details...</p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" id="downloadPartDetailBtn" style="display: none;">
                            üì• Download JSON
                        </button>
                        <button class="btn btn-primary" id="closePartDetailModalBtn">Close</button>
                    </div>
                </div>
            </div>
            
            <!-- Automation Progress Modal -->
            <div id="automationProgressModal" class="modal hidden">
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h2>üîÑ Exporting Parts</h2>
                        <button class="modal-close" id="closeProgressModal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div id="progressInfo">
                            <p style="font-size: 16px; margin-bottom: 10px;">
                                Processing group <strong><span id="currentGroupNum">0</span></strong> of <strong><span id="totalGroups">0</span></strong>
                            </p>
                            <p id="currentGroupName" style="color: #666; margin-bottom: 15px;"></p>
                            <div style="background: #e9ecef; border-radius: 10px; height: 20px; margin-bottom: 15px; overflow: hidden;">
                                <div id="progressBarFill" style="background: #28a745; height: 100%; width: 0%; transition: width 0.3s ease;"></div>
                            </div>
                            <p style="margin-bottom: 15px;">
                                Parts collected: <strong><span id="totalPartsCollected">0</span></strong>
                            </p>
                            <div id="progressLog" style="max-height: 200px; overflow-y: auto; margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px; font-size: 13px;">
                                <!-- Status messages will appear here -->
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-danger" id="stopAutomationBtn">Stop</button>
                        <button class="btn btn-primary" id="closeProgressModalBtn" style="display: none;">Close</button>
                    </div>
                </div>
            </div>
            
            <!-- Parts Display Area -->
            <div id="partsView" class="auth-form hidden">
                <div class="breadcrumb" id="partsBreadcrumb">
                    <span class="breadcrumb-item">
                        <a href="#" class="breadcrumb-link" id="breadcrumbVinFromParts">VIN</a>
                    </span>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <span class="breadcrumb-item">
                        <a href="#" class="breadcrumb-link" id="breadcrumbTreeFromParts">Catalog Tree</a>
                    </span>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <span class="breadcrumb-item">
                        <a href="#" class="breadcrumb-link" id="breadcrumbManufacturers">Manufacturers</a>
                    </span>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <span class="breadcrumb-item active">
                        <span id="breadcrumbPartsName">Parts List</span>
                    </span>
                </div>
                <div class="nav-header">
                    <div class="nav-title">
                        <h2>üîß Parts List</h2>
                        <span class="subtitle" id="partsSubtitle">Parts for selected manufacturers</span>
                    </div>
                    <button class="btn btn-secondary" id="backToManufacturersBtn">‚Üê Back to Manufacturers</button>
                </div>
                <div id="partsLoading" class="upload-loader" style="display: none;">
                    <div class="loader-content">
                        <div class="upload-spinner"></div>
                        <div class="upload-info">Loading parts...</div>
                    </div>
                </div>
                <div id="partsContent">
                    <div id="partsList" style="max-height: 600px; overflow-y: auto;"></div>
                </div>
            </div>
            
            <!-- Catalog Tree View -->
            <div id="treeView" class="hidden">
                <div class="breadcrumb" id="treeBreadcrumb">
                    <span class="breadcrumb-item">
                        <a href="#" class="breadcrumb-link" id="breadcrumbVin">VIN</a>
                    </span>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <span class="breadcrumb-item active">
                        <span>Catalog Tree</span>
                    </span>
                </div>
                <div class="nav-header">
                    <div class="nav-title">
                        <h2>üìã Parts Catalog</h2>
                        <span class="subtitle">Select one or more catalog objects, then click Next</span>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" id="nextToManufacturersBtn" style="display: none;">Next ‚Üí</button>
                        <button class="btn btn-success" id="exportAllPartsBtn">üì• Export All Parts to CSV</button>
                        <button class="btn btn-secondary" id="backToVinBtn">‚Üê Back to VIN</button>
                    </div>
                </div>
                <div id="catalogSelectionInfo" style="padding: 10px; margin-bottom: 15px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 5px; display: block;">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                        <span id="selectedCatalogCount" style="font-weight: 600; color: #856404;">0 catalog objects selected</span>
                        <span style="font-size: 12px; color: #856404;">üí° <strong>Tip:</strong> Hold <kbd style="background: #fff; padding: 2px 6px; border: 1px solid #ccc; border-radius: 3px; font-size: 11px;">Ctrl</kbd> (Windows/Linux) or <kbd style="background: #fff; padding: 2px 6px; border: 1px solid #ccc; border-radius: 3px; font-size: 11px;">Cmd</kbd> (Mac) and click to select multiple items</span>
                    </div>
                </div>
            </div>
            
            <div id="tree"></div>
        </div>
    </div>
    
    <!-- Application Modules (Order matters - load in dependency order) -->
    <script src="js/modules/state.js"></script>
    <script src="js/modules/utils.js"></script>
    <script src="js/modules/tree.js"></script>
    <script src="js/modules/ui.js"></script>
    <script src="js/modules/api.js"></script>
    <script src="js/modules/automation.js"></script>
    <script src="js/modules/events.js"></script>
    
    <!-- Main Application -->
    <script src="js/app.js"></script>
</body>
</html>
